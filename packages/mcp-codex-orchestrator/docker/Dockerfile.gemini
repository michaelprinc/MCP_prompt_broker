# Gemini CLI Container
# Lightweight container for running Google Gemini CLI

FROM node:20-slim

LABEL maintainer="MCP Prompt Broker Team"
LABEL description="Gemini CLI runner for MCP Orchestrator"
LABEL version="1.0"

RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    ca-certificates \
    python3 \
    python3-pip \
    python3-venv \
    && rm -rf /var/lib/apt/lists/*

# Install Gemini CLI globally
RUN npm install -g @google/gemini-cli

# Optional tooling for verification loops
RUN pip3 install --no-cache-dir --break-system-packages pytest ruff

# Create non-root user and required directories
RUN useradd -m runner && \
    mkdir -p /workspace /runs /home/runner/.gemini && \
    chown -R runner:runner /workspace /runs /home/runner

USER runner

ENV HOME=/home/runner
ENV GEMINI_HOME=/home/runner/.gemini

WORKDIR /workspace

ENV NODE_ENV=production

ENTRYPOINT ["gemini"]
CMD ["--help"]
